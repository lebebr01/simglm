<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tidy Simulation with `simglm` • simglm</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Tidy Simulation with `simglm`">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-43425299-3"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-43425299-3');
</script>
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">simglm</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.9.23</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Propensity.html">Propensity Simulation for `simglm`</a>
    </li>
    <li>
      <a href="../articles/simulation_arguments.html">Simulation Argument Details for `simglm`</a>
    </li>
    <li>
      <a href="../articles/tidy_simulation.html">Tidy Simulation with `simglm`</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/lebebr01/simglm/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Tidy Simulation with <code>simglm</code>
</h1>
            
            <h4 data-toc-skip class="date">2025-10-01</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/lebebr01/simglm/blob/main/vignettes/tidy_simulation.Rmd" class="external-link"><code>vignettes/tidy_simulation.Rmd</code></a></small>
      <div class="hidden name"><code>tidy_simulation.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="tidy-simulation-with-simglm">Tidy Simulation with <code>simglm</code><a class="anchor" aria-label="anchor" href="#tidy-simulation-with-simglm"></a>
</h2>
<p>Introducing a new framework for simulation and power analysis with
the <code>simglm</code> package, tidy simulation. The package now has
helper functions in which the first argument is always the data and the
second argument is always the simulation arguments. A second vignette is
written that contains a more exhaustive list of simulation arguments
that are allowed. This vignette will give the basics needed to specify
simulation arguments to generate simulated data.</p>
</div>
<div class="section level2">
<h2 id="functions-for-basic-simulation">Functions for Basic Simulation<a class="anchor" aria-label="anchor" href="#functions-for-basic-simulation"></a>
</h2>
<p>There are four primary functions to be used for basic simulation
functionality. These include:</p>
<ul>
<li>
<code>simulate_fixed</code>: simulate fixed effects</li>
<li>
<code>simulate_error</code>: simulate random error</li>
<li>
<code>simulate_randomeffects</code>: simulate random effects or
cluster residuals</li>
<li>
<code>generate_response</code>: based on fixed, error, and random
effects, generate outcome variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Y</mi><mi>j</mi></msub><annotation encoding="application/x-tex">Y_{j}</annotation></semantics></math>
given the following
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Y</mi><mi>j</mi></msub><mo>=</mo><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>j</mi></msub><mi>β</mi><mo>+</mo><msub><mi>Z</mi><mi>j</mi></msub><msub><mi>b</mi><mi>j</mi></msub><mo>+</mo><msub><mi>e</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">Y_{j} = g(X_{j} \beta + Z_{j} b_{j} + e_{j})</annotation></semantics></math>.</li>
</ul>
<p>We will dive into what each of these component represent in a second,
but first let’s start with an example that simulates a linear regression
model.</p>
<div class="section level3">
<h3 id="first-linear-regression-example">First Linear Regression Example<a class="anchor" aria-label="anchor" href="#first-linear-regression-example"></a>
</h3>
<p>Let us assume for this first example that our outcome of interest is
continuous and that the data is not clustered. In this example, our
model would look like:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Y</mi><mi>j</mi></msub><mo>=</mo><msub><mi>X</mi><mi>j</mi></msub><mi>β</mi><mo>+</mo><msub><mi>e</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">Y_{j} = X_{j} \beta + e_{j}</annotation></semantics></math>.
In this equation,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Y</mi><mi>j</mi></msub><annotation encoding="application/x-tex">Y_{j}</annotation></semantics></math>
represents the continuous outcome,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>X</mi><mi>j</mi></msub><mi>β</mi></mrow><annotation encoding="application/x-tex">X_{j} \beta</annotation></semantics></math>
represents the fixed portion of the model comprised of regression
coefficients
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>)
and a design matrix
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>X</mi><mi>j</mi></msub><annotation encoding="application/x-tex">X_{j}</annotation></semantics></math>),
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>e</mi><mi>j</mi></msub><annotation encoding="application/x-tex">e_{j}</annotation></semantics></math>
represents random error.</p>
<div class="section level4">
<h4 id="fixed-portion-of-model">Fixed Portion of Model<a class="anchor" aria-label="anchor" href="#fixed-portion-of-model"></a>
</h4>
<p>The fixed portion of the model represents variables that are treated
as fixed. This means that the values observed in the data are the only
values we are interested in, will generalize to, or that we consider
values of interest in our population. Let us consider the following
formula: <code>y ~ 1 + x1 + x2</code>. In this formula there are a total
of two variables that are assumed to be fixed, <code>x1</code> and
<code>x2</code>. These variables together with an intercept would make
up the design matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>X</mi><mi>j</mi></msub><annotation encoding="application/x-tex">X_{j}</annotation></semantics></math>.
Let’s generate some example data using the <code>simglm</code> package
and the <code>simulate_fixed</code> function.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lebebr01/simglm" class="external-link">simglm</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">321</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">sim_arguments</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span>,</span>
<span>  fixed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>var_type <span class="op">=</span> <span class="st">'continuous'</span>, </span>
<span>                         mean <span class="op">=</span> <span class="fl">180</span>, sd <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>,</span>
<span>               x2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>var_type <span class="op">=</span> <span class="st">'continuous'</span>, </span>
<span>                         mean <span class="op">=</span> <span class="fl">40</span>, sd <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  sample_size <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/simulate_fixed.html">simulate_fixed</a></span><span class="op">(</span>data <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">sim_arguments</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    X.Intercept.       x1       x2 level1_id</span></span>
<span><span class="co">## 1             1 231.1471 41.73851         1</span></span>
<span><span class="co">## 2             1 158.6388 47.42296         2</span></span>
<span><span class="co">## 3             1 171.6605 40.94163         3</span></span>
<span><span class="co">## 4             1 176.4105 52.21630         4</span></span>
<span><span class="co">## 5             1 176.2812 34.23280         5</span></span>
<span><span class="co">## 6             1 188.0455 35.97664         6</span></span>
<span><span class="co">## 7             1 201.8052 42.28035         7</span></span>
<span><span class="co">## 8             1 186.9941 42.10166         8</span></span>
<span><span class="co">## 9             1 190.1734 42.88792         9</span></span>
<span><span class="co">## 10            1 163.4426 42.23178        10</span></span></code></pre>
<p>The first three columns of the resulting data frame is the design
matrix described above,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>X</mi><mi>j</mi></msub><annotation encoding="application/x-tex">X_{j}</annotation></semantics></math>.
You may have noticed that the <code>simulate_fixed</code> function needs
three elements defined in the simulation arguments (called
<code>sim_arguments</code>) above. These elements are:</p>
<ul>
<li>
<code>formula</code>: this argument represents a R formula that is
used to represent the model that is wished to be simulated. For the
<code>simulate_fixed</code> argument, only the right hand side is
used.</li>
<li>
<code>fixed</code>: these represent the specific details for
generating the variables (other than the intercept) in the right hand
side of the <code>formula</code> simulation argument. Each variable is
specified as its own list by name in the <code>formula</code> argument
and the <code>var_type</code> specifies the type of variable to
generate. The <code>vary_type</code> argument is required for each fixed
variable to simulate. Optional arguments, for example
<code>mean =</code> and <code>sd =</code> above, will be discussed in
more detail later.</li>
<li>
<code>sample_size</code>: this argument tells the function how many
responses to generate.</li>
</ul>
<p>The columns <code>x1</code> and <code>x2</code> would represent
variables that we would gather if these data were real. To reflect a
real life scenario, consider the following fixed simuation.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">321</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">sim_arguments</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">weight</span> <span class="op">+</span> <span class="va">age</span>,</span>
<span>  fixed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>var_type <span class="op">=</span> <span class="st">'continuous'</span>, mean <span class="op">=</span> <span class="fl">180</span>, sd <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>,</span>
<span>               age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>var_type <span class="op">=</span> <span class="st">'continuous'</span>, mean <span class="op">=</span> <span class="fl">40</span>, sd <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  sample_size <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/simulate_fixed.html">simulate_fixed</a></span><span class="op">(</span>data <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">sim_arguments</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    X.Intercept.   weight      age level1_id</span></span>
<span><span class="co">## 1             1 231.1471 41.73851         1</span></span>
<span><span class="co">## 2             1 158.6388 47.42296         2</span></span>
<span><span class="co">## 3             1 171.6605 40.94163         3</span></span>
<span><span class="co">## 4             1 176.4105 52.21630         4</span></span>
<span><span class="co">## 5             1 176.2812 34.23280         5</span></span>
<span><span class="co">## 6             1 188.0455 35.97664         6</span></span>
<span><span class="co">## 7             1 201.8052 42.28035         7</span></span>
<span><span class="co">## 8             1 186.9941 42.10166         8</span></span>
<span><span class="co">## 9             1 190.1734 42.88792         9</span></span>
<span><span class="co">## 10            1 163.4426 42.23178        10</span></span></code></pre>
<p>Now instead of the variables being called <code>x1</code> and
<code>x2</code>, they now reflect variables weight (measured in lbs) and
age (measured continuously, not rounded to whole digits). If we wished
to change the <code>'age'</code> variable to be rounded to a whole
integer, we could change the variable type to <code>'ordinal'</code> as
such.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">321</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">sim_arguments</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">weight</span> <span class="op">+</span> <span class="va">age</span>,</span>
<span>  fixed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>var_type <span class="op">=</span> <span class="st">'continuous'</span>, mean <span class="op">=</span> <span class="fl">180</span>, sd <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>,</span>
<span>               age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>var_type <span class="op">=</span> <span class="st">'ordinal'</span>, levels <span class="op">=</span> <span class="fl">30</span><span class="op">:</span><span class="fl">60</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  sample_size <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/simulate_fixed.html">simulate_fixed</a></span><span class="op">(</span>data <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">sim_arguments</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    X.Intercept.   weight age level1_id</span></span>
<span><span class="co">## 1             1 231.1471  44         1</span></span>
<span><span class="co">## 2             1 158.6388  38         2</span></span>
<span><span class="co">## 3             1 171.6605  31         3</span></span>
<span><span class="co">## 4             1 176.4105  40         4</span></span>
<span><span class="co">## 5             1 176.2812  60         5</span></span>
<span><span class="co">## 6             1 188.0455  47         6</span></span>
<span><span class="co">## 7             1 201.8052  33         7</span></span>
<span><span class="co">## 8             1 186.9941  43         8</span></span>
<span><span class="co">## 9             1 190.1734  52         9</span></span>
<span><span class="co">## 10            1 163.4426  31        10</span></span></code></pre>
<p>When specifying a <code>var_type</code> as <code>'ordinal'</code>, an
additional <code>levels</code> argument is needed to determine which
values are possible for the simulation. The last type of variable that
is useful to discuss now would be factor or categorical variables. These
variables can be generated by setting the
<code>var_type = 'factor'</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">321</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">sim_arguments</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">weight</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">sex</span>,</span>
<span>  fixed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>var_type <span class="op">=</span> <span class="st">'continuous'</span>, mean <span class="op">=</span> <span class="fl">180</span>, sd <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>,</span>
<span>               age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>var_type <span class="op">=</span> <span class="st">'ordinal'</span>, levels <span class="op">=</span> <span class="fl">30</span><span class="op">:</span><span class="fl">60</span><span class="op">)</span>,</span>
<span>               sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>var_type <span class="op">=</span> <span class="st">'factor'</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'male'</span>, <span class="st">'female'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  sample_size <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/simulate_fixed.html">simulate_fixed</a></span><span class="op">(</span>data <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">sim_arguments</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    X.Intercept.   weight age sex_1    sex level1_id</span></span>
<span><span class="co">## 1             1 231.1471  44     1 female         1</span></span>
<span><span class="co">## 2             1 158.6388  38     1 female         2</span></span>
<span><span class="co">## 3             1 171.6605  31     1 female         3</span></span>
<span><span class="co">## 4             1 176.4105  40     1 female         4</span></span>
<span><span class="co">## 5             1 176.2812  60     0   male         5</span></span>
<span><span class="co">## 6             1 188.0455  47     1 female         6</span></span>
<span><span class="co">## 7             1 201.8052  33     1 female         7</span></span>
<span><span class="co">## 8             1 186.9941  43     0   male         8</span></span>
<span><span class="co">## 9             1 190.1734  52     1 female         9</span></span>
<span><span class="co">## 10            1 163.4426  31     1 female        10</span></span></code></pre>
<p>The required arguments when a factor variable are identical to an
ordinal variable, however for factor variables the <code>levels</code>
argument can either be an integer or can be a character vector where the
character labels are specified directly. As you can see from the output,
when a character vector is used, two variables are returned, one that
contains the variable represented numerically and another that is the
variable represented as a character vector. More details on this
behavior to follow.</p>
</div>
</div>
<div class="section level3">
<h3 id="simulate-random-error">Simulate Random Error<a class="anchor" aria-label="anchor" href="#simulate-random-error"></a>
</h3>
<p>The simulation of random error
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>e</mi><mi>j</mi></msub><annotation encoding="application/x-tex">e_{j}</annotation></semantics></math>
from the equation above) is a bit simpler than generating the fixed
effects. Suppose for example, we want to simply simulate random errors
that are normally distributed with a mean of 0 and a variance of 1. This
can be done with the <code>simulate_error</code> function.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">321</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim_arguments</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  sample_size <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/simulate_error.html">simulate_error</a></span><span class="op">(</span>data <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">sim_arguments</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##         error level1_id</span></span>
<span><span class="co">## 1   1.7049032         1</span></span>
<span><span class="co">## 2  -0.7120386         2</span></span>
<span><span class="co">## 3  -0.2779849         3</span></span>
<span><span class="co">## 4  -0.1196490         4</span></span>
<span><span class="co">## 5  -0.1239606         5</span></span>
<span><span class="co">## 6   0.2681838         6</span></span>
<span><span class="co">## 7   0.7268415         7</span></span>
<span><span class="co">## 8   0.2331354         8</span></span>
<span><span class="co">## 9   0.3391139         9</span></span>
<span><span class="co">## 10 -0.5519147        10</span></span></code></pre>
<p>The <code>simulate_error</code> function only needs to know how many
data values to simulate. By default, the <code>rnorm</code> function is
used to generate random error and this function assumes a mean of 0 and
standard deviation of 1 by default. I personally prefer the slightly
more verbose code however.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">321</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim_arguments</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>variance <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  sample_size <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/simulate_error.html">simulate_error</a></span><span class="op">(</span>data <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">sim_arguments</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##         error level1_id</span></span>
<span><span class="co">## 1   1.7049032         1</span></span>
<span><span class="co">## 2  -0.7120386         2</span></span>
<span><span class="co">## 3  -0.2779849         3</span></span>
<span><span class="co">## 4  -0.1196490         4</span></span>
<span><span class="co">## 5  -0.1239606         5</span></span>
<span><span class="co">## 6   0.2681838         6</span></span>
<span><span class="co">## 7   0.7268415         7</span></span>
<span><span class="co">## 8   0.2331354         8</span></span>
<span><span class="co">## 9   0.3391139         9</span></span>
<span><span class="co">## 10 -0.5519147        10</span></span></code></pre>
<p>This code makes it clearer when the variance of the errors is wished
to be specified as some other value. For example:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">321</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim_arguments</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>variance <span class="op">=</span> <span class="fl">25</span><span class="op">)</span>,</span>
<span>  sample_size <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/simulate_error.html">simulate_error</a></span><span class="op">(</span>data <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">sim_arguments</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##         error level1_id</span></span>
<span><span class="co">## 1   8.5245161         1</span></span>
<span><span class="co">## 2  -3.5601928         2</span></span>
<span><span class="co">## 3  -1.3899246         3</span></span>
<span><span class="co">## 4  -0.5982451         4</span></span>
<span><span class="co">## 5  -0.6198031         5</span></span>
<span><span class="co">## 6   1.3409189         6</span></span>
<span><span class="co">## 7   3.6342074         7</span></span>
<span><span class="co">## 8   1.1656771         8</span></span>
<span><span class="co">## 9   1.6955694         9</span></span>
<span><span class="co">## 10 -2.7595733        10</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="generate-response-variable">Generate Response Variable<a class="anchor" aria-label="anchor" href="#generate-response-variable"></a>
</h3>
<p>Now that we have seen the basics of simulating fixed variables
(covariates) and random error, we can now generate the response by
combining the previous two steps and then using the
<code>generate_response</code> function. What makes this a tidy
simulation is that the pipe from magrittr, <code>|&gt;</code> can be
used to combine steps into a simulation pipeline.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">321</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">sim_arguments</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">weight</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">sex</span>,</span>
<span>  fixed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>var_type <span class="op">=</span> <span class="st">'continuous'</span>, mean <span class="op">=</span> <span class="fl">180</span>, sd <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>,</span>
<span>               age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>var_type <span class="op">=</span> <span class="st">'ordinal'</span>, levels <span class="op">=</span> <span class="fl">30</span><span class="op">:</span><span class="fl">60</span><span class="op">)</span>,</span>
<span>               sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>var_type <span class="op">=</span> <span class="st">'factor'</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'male'</span>, <span class="st">'female'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>variance <span class="op">=</span> <span class="fl">25</span><span class="op">)</span>,</span>
<span>  sample_size <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  reg_weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">0.3</span>, <span class="op">-</span><span class="fl">0.1</span>, <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/simulate_fixed.html">simulate_fixed</a></span><span class="op">(</span>data <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">sim_arguments</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/simulate_error.html">simulate_error</a></span><span class="op">(</span><span class="va">sim_arguments</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/generate_response.html">generate_response</a></span><span class="op">(</span><span class="va">sim_arguments</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    X.Intercept.   weight age sex_1    sex level1_id       error fixed_outcome</span></span>
<span><span class="co">## 1             1 231.1471  44     1 female         1   4.5862776      67.44413</span></span>
<span><span class="co">## 2             1 158.6388  38     1 female         2  -0.5353077      46.29165</span></span>
<span><span class="co">## 3             1 171.6605  31     1 female         3   4.9416770      50.89814</span></span>
<span><span class="co">## 4             1 176.4105  40     1 female         4  -5.3611940      51.42316</span></span>
<span><span class="co">## 5             1 176.2812  60     0   male         5  -3.7900764      48.88435</span></span>
<span><span class="co">## 6             1 188.0455  47     1 female         6   0.4750036      54.21365</span></span>
<span><span class="co">## 7             1 201.8052  33     1 female         7 -11.6546559      59.74157</span></span>
<span><span class="co">## 8             1 186.9941  43     0   male         8   2.0875799      53.79822</span></span>
<span><span class="co">## 9             1 190.1734  52     1 female         9  -5.6016371      54.35202</span></span>
<span><span class="co">## 10            1 163.4426  31     1 female        10  -2.3734235      48.43277</span></span>
<span><span class="co">##    random_effects        y</span></span>
<span><span class="co">## 1               0 72.03041</span></span>
<span><span class="co">## 2               0 45.75635</span></span>
<span><span class="co">## 3               0 55.83981</span></span>
<span><span class="co">## 4               0 46.06196</span></span>
<span><span class="co">## 5               0 45.09428</span></span>
<span><span class="co">## 6               0 54.68866</span></span>
<span><span class="co">## 7               0 48.08692</span></span>
<span><span class="co">## 8               0 55.88580</span></span>
<span><span class="co">## 9               0 48.75039</span></span>
<span><span class="co">## 10              0 46.05934</span></span></code></pre>
<p>The only additional argument that is needed for the
<code>generate_response</code> function is the <code>reg_weights</code>
argument. This argument represents the regression coefficients
associated with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>
in the equation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Y</mi><mi>j</mi></msub><mo>=</mo><msub><mi>X</mi><mi>j</mi></msub><mi>β</mi><mo>+</mo><msub><mi>e</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">Y_{j} = X_{j} \beta + e_{j}</annotation></semantics></math>.
The regression coefficients are multiplied by the design matrix to
generate the column labeled “fixed_outcome” in the output. The output
also contains the column, “random_effects” which are all 0 here
indicating there are no random effects and the response variable,
“y”.</p>
<div class="section level4">
<h4 id="generate-response-with-more-than-2-factor-levels">Generate Response with more than 2 factor levels<a class="anchor" aria-label="anchor" href="#generate-response-with-more-than-2-factor-levels"></a>
</h4>
<p>Earlier, a factor or categorical grouping factor with 2 levels was
shown. It may be of interest to generate a factor or categorical
attribute with more than 2 levels, a feature that is built into
simglm.</p>
<p>The creation a categorical attribute with more than two level is
similar to that with 2 levels. The following code creates a categorical
attribute with 4 levels based on the grade, freshman, sophomore, junior,
or senior. To add more levels, the user would just add more categories
to the levels argument. Below, the data are generated and a table
showing the different categories are shown.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">321</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">sim_arguments</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">weight</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">grade</span>,</span>
<span>  fixed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>var_type <span class="op">=</span> <span class="st">'continuous'</span>, mean <span class="op">=</span> <span class="fl">180</span>, sd <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>,</span>
<span>               age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>var_type <span class="op">=</span> <span class="st">'ordinal'</span>, levels <span class="op">=</span> <span class="fl">30</span><span class="op">:</span><span class="fl">60</span><span class="op">)</span>,</span>
<span>               sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>var_type <span class="op">=</span> <span class="st">'factor'</span>, </span>
<span>                          levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'male'</span>, <span class="st">'female'</span><span class="op">)</span><span class="op">)</span>,</span>
<span>               grade <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>var_type <span class="op">=</span> <span class="st">'factor'</span>, </span>
<span>                            levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'freshman'</span>, <span class="st">'sophomore'</span>,</span>
<span>                                       <span class="st">'junior'</span>, <span class="st">'senior'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>variance <span class="op">=</span> <span class="fl">25</span><span class="op">)</span>,</span>
<span>  sample_size <span class="op">=</span> <span class="fl">100</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/simulate_fixed.html">simulate_fixed</a></span><span class="op">(</span>data <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">sim_arguments</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/simulate_error.html">simulate_error</a></span><span class="op">(</span><span class="va">sim_arguments</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">grade</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##       grade  n</span></span>
<span><span class="co">## 1  freshman 27</span></span>
<span><span class="co">## 2 sophomore 20</span></span>
<span><span class="co">## 3    junior 32</span></span>
<span><span class="co">## 4    senior 21</span></span></code></pre>
<p>The levels of the new grade attribute could also be modified to
include unequal probabilities for each class to be sampled. To do this,
the prob argument could be passed as follows.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">321</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">sim_arguments</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">weight</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">grade</span>,</span>
<span>  fixed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>var_type <span class="op">=</span> <span class="st">'continuous'</span>, mean <span class="op">=</span> <span class="fl">180</span>, sd <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>,</span>
<span>               age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>var_type <span class="op">=</span> <span class="st">'ordinal'</span>, levels <span class="op">=</span> <span class="fl">30</span><span class="op">:</span><span class="fl">60</span><span class="op">)</span>,</span>
<span>               sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>var_type <span class="op">=</span> <span class="st">'factor'</span>, </span>
<span>                          levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'male'</span>, <span class="st">'female'</span><span class="op">)</span><span class="op">)</span>,</span>
<span>               grade <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>var_type <span class="op">=</span> <span class="st">'factor'</span>, </span>
<span>                            levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'freshman'</span>, <span class="st">'sophomore'</span>,</span>
<span>                                       <span class="st">'junior'</span>, <span class="st">'senior'</span><span class="op">)</span>,</span>
<span>                            prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.05</span>, <span class="fl">.3</span>, <span class="fl">.45</span>, <span class="fl">.2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>variance <span class="op">=</span> <span class="fl">25</span><span class="op">)</span>,</span>
<span>  sample_size <span class="op">=</span> <span class="fl">100</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/simulate_fixed.html">simulate_fixed</a></span><span class="op">(</span>data <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">sim_arguments</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/simulate_error.html">simulate_error</a></span><span class="op">(</span><span class="va">sim_arguments</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">grade</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##       grade  n</span></span>
<span><span class="co">## 1  freshman  6</span></span>
<span><span class="co">## 2 sophomore 26</span></span>
<span><span class="co">## 3    junior 43</span></span>
<span><span class="co">## 4    senior 25</span></span></code></pre>
<p>When generating more than 2 levels for a categorical attribute, the
default behavior within R and with simglm is to create dummy or
indicator variables to be used within a linear model. Therefore, in
order to generate the outcome for an attribute with more than 2 levels,
multiple indicator or dummy attributes need to be created. The number of
indicator or dummy attributes is always 1 less than the number of
categories, so for the grade attribute example, there needs to be 3
indicator attributes to represent the 4 categories within a linear
model. An example of what these indicators attributes would look like is
presented below.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  grade <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'freshman'</span>, <span class="st">'sophomore'</span>, <span class="st">'junior'</span>, <span class="st">'senior'</span><span class="op">)</span>,</span>
<span>                 size <span class="op">=</span> <span class="fl">10</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">mutate</span><span class="op">(</span>sophomore <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">grade</span> <span class="op">==</span> <span class="st">'sophomore'</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>         junior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">grade</span> <span class="op">==</span> <span class="st">'junior'</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>, </span>
<span>         senior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">grade</span> <span class="op">==</span> <span class="st">'senior'</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        grade sophomore junior senior</span></span>
<span><span class="co">## 1     junior         0      1      0</span></span>
<span><span class="co">## 2   freshman         0      0      0</span></span>
<span><span class="co">## 3     junior         0      1      0</span></span>
<span><span class="co">## 4  sophomore         1      0      0</span></span>
<span><span class="co">## 5     senior         0      0      1</span></span>
<span><span class="co">## 6   freshman         0      0      0</span></span>
<span><span class="co">## 7  sophomore         1      0      0</span></span>
<span><span class="co">## 8  sophomore         1      0      0</span></span>
<span><span class="co">## 9  sophomore         1      0      0</span></span>
<span><span class="co">## 10  freshman         0      0      0</span></span></code></pre>
<p>Each indicator takes a value of 1 or 0 for each new column created.
These indicate which category is represented by each attribute, for
example, the 1 for the sophomore column indicates that this term would
represent the effect of moving from the reference group to the sophomore
category. The reference group is selected by the group or category that
does not have an indicator attribute for it, in this example it is the
freshman group. The default behavior in R is to use the category that is
closest to “A” in alphabetical order.</p>
<p>It is important to understand how the indicator attributes are
generated as this will impact how the response outcome is created. In
this case, since there will be 3 indicator variables to represent the 4
categories of the grade attribute, 3 regression weights will need to be
added to the <code>reg_weights</code> argument. These terms would
represent the effect (mean level change) from moving from the reference
group to each of the indicator variables. Using the example above, this
would reflect the mean difference between freshman and sophomore,
freshman and junior, and freshman and senior.</p>
<p>The other element that needs to be kept track of, is the order that
these indicator attributes are created by R. The default behavior is for
these to be created in alphabetical order. The simglm package modifies
this default behavior to convert those specified with a character vector
for the <code>levels</code> argument to be in the same order as
specified. This is important as it has implications for the
interpretation of the terms specified within <code>reg_weights</code>.
To be more concrete, what this means is that the last three terms
specified within the <code>reg_weights</code> argument (ie., .75, 1.8,
and 2.5) would respectively represent the difference between the
sophomore, junior, and senior groups compared to the freshman group.
Therefore, the average mean difference between the freshman and
sophomore groups would be .75, the mean difference between the freshman
and junior groups would be 1.8, and the mean difference between the
freshman and senior groups would be 2.5. You could confirm this by
saving the simulated data below and fitting a linear regression using
the <code>lm</code> function as follows:
<code>lm(y ~ 1 + weight + age + sex + grade, data = &amp;&amp;)</code>
where the saved data object is placed instead of the
<code>&amp;&amp;</code>.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">321</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">sim_arguments</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">weight</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">grade</span>,</span>
<span>  fixed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>var_type <span class="op">=</span> <span class="st">'continuous'</span>, mean <span class="op">=</span> <span class="fl">180</span>, sd <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>,</span>
<span>               age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>var_type <span class="op">=</span> <span class="st">'ordinal'</span>, levels <span class="op">=</span> <span class="fl">30</span><span class="op">:</span><span class="fl">60</span><span class="op">)</span>,</span>
<span>               sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>var_type <span class="op">=</span> <span class="st">'factor'</span>, </span>
<span>                          levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'male'</span>, <span class="st">'female'</span><span class="op">)</span><span class="op">)</span>,</span>
<span>               grade <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>var_type <span class="op">=</span> <span class="st">'factor'</span>, </span>
<span>                            levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'freshman'</span>, <span class="st">'sophomore'</span>,</span>
<span>                                       <span class="st">'junior'</span>, <span class="st">'senior'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>variance <span class="op">=</span> <span class="fl">25</span><span class="op">)</span>,</span>
<span>  sample_size <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>  reg_weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">.1</span>, <span class="fl">.55</span>, <span class="fl">1.5</span>, <span class="fl">.75</span>, <span class="fl">1.8</span>, <span class="fl">2.5</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/simulate_fixed.html">simulate_fixed</a></span><span class="op">(</span>data <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">sim_arguments</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/simulate_error.html">simulate_error</a></span><span class="op">(</span><span class="va">sim_arguments</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/generate_response.html">generate_response</a></span><span class="op">(</span><span class="va">sim_arguments</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   X.Intercept.   weight age sex_1 grade_1 grade_2 grade_3    sex     grade</span></span>
<span><span class="co">## 1            1 231.1471  49     1       1       0       0 female sophomore</span></span>
<span><span class="co">## 2            1 158.6388  58     1       0       1       0 female    junior</span></span>
<span><span class="co">## 3            1 171.6605  43     1       0       0       0 female  freshman</span></span>
<span><span class="co">## 4            1 176.4105  37     0       0       0       0   male  freshman</span></span>
<span><span class="co">## 5            1 176.2812  45     1       0       0       1 female    senior</span></span>
<span><span class="co">## 6            1 188.0455  58     0       0       0       0   male  freshman</span></span>
<span><span class="co">##   level1_id      error fixed_outcome random_effects        y</span></span>
<span><span class="co">## 1         1  0.0718251      54.31471              0 54.38653</span></span>
<span><span class="co">## 2         2 -0.7071167      53.06388              0 52.35677</span></span>
<span><span class="co">## 3         3  2.2538313      44.31605              0 46.56988</span></span>
<span><span class="co">## 4         4  4.1403091      39.99105              0 44.13136</span></span>
<span><span class="co">## 5         5 -0.4405120      48.37812              0 47.93761</span></span>
<span><span class="co">## 6         6  2.9550896      52.70455              0 55.65964</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="non-normal-outcomes">Non-normal Outcomes<a class="anchor" aria-label="anchor" href="#non-normal-outcomes"></a>
</h4>
<p>Non-normal outcomes are possible with simglm. Two non-normal outcomes
are currently supported with more support coming in the future. Binary
and count outcomes are supported and can be specified with the
<code>outcome_type</code> simulation argument. If
<code>outcome_type = 'logistic'</code> or
<code>outcome_type = 'binary'</code> then a binary outcome is generated
(ie. 0/1 variable) using the <code>rbinom</code> function. If
<code>outcome_type = 'count'</code> or
<code>outcome_type = 'poisson'</code> then the outcome is transformed to
be a count variable (ie. discrete variable; 0, 1, 2, etc.).</p>
<p>Here is an example of generating a binary outcome.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">321</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">sim_arguments</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">weight</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">sex</span>,</span>
<span>  fixed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>var_type <span class="op">=</span> <span class="st">'continuous'</span>, mean <span class="op">=</span> <span class="fl">180</span>, sd <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>,</span>
<span>               age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>var_type <span class="op">=</span> <span class="st">'ordinal'</span>, levels <span class="op">=</span> <span class="fl">30</span><span class="op">:</span><span class="fl">60</span><span class="op">)</span>,</span>
<span>               sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>var_type <span class="op">=</span> <span class="st">'factor'</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'male'</span>, <span class="st">'female'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>variance <span class="op">=</span> <span class="fl">25</span><span class="op">)</span>,</span>
<span>  sample_size <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  reg_weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">0.3</span>, <span class="op">-</span><span class="fl">0.1</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>  outcome_type <span class="op">=</span> <span class="st">'binary'</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/simulate_fixed.html">simulate_fixed</a></span><span class="op">(</span>data <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">sim_arguments</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/simulate_error.html">simulate_error</a></span><span class="op">(</span><span class="va">sim_arguments</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/generate_response.html">generate_response</a></span><span class="op">(</span><span class="va">sim_arguments</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    X.Intercept.   weight age sex_1    sex level1_id       error fixed_outcome</span></span>
<span><span class="co">## 1             1 231.1471  44     1 female         1   4.5862776      67.44413</span></span>
<span><span class="co">## 2             1 158.6388  38     1 female         2  -0.5353077      46.29165</span></span>
<span><span class="co">## 3             1 171.6605  31     1 female         3   4.9416770      50.89814</span></span>
<span><span class="co">## 4             1 176.4105  40     1 female         4  -5.3611940      51.42316</span></span>
<span><span class="co">## 5             1 176.2812  60     0   male         5  -3.7900764      48.88435</span></span>
<span><span class="co">## 6             1 188.0455  47     1 female         6   0.4750036      54.21365</span></span>
<span><span class="co">## 7             1 201.8052  33     1 female         7 -11.6546559      59.74157</span></span>
<span><span class="co">## 8             1 186.9941  43     0   male         8   2.0875799      53.79822</span></span>
<span><span class="co">## 9             1 190.1734  52     1 female         9  -5.6016371      54.35202</span></span>
<span><span class="co">## 10            1 163.4426  31     1 female        10  -2.3734235      48.43277</span></span>
<span><span class="co">##    random_effects untransformed_outcome y</span></span>
<span><span class="co">## 1               0              72.03041 1</span></span>
<span><span class="co">## 2               0              45.75635 1</span></span>
<span><span class="co">## 3               0              55.83981 1</span></span>
<span><span class="co">## 4               0              46.06196 1</span></span>
<span><span class="co">## 5               0              45.09428 1</span></span>
<span><span class="co">## 6               0              54.68866 1</span></span>
<span><span class="co">## 7               0              48.08692 1</span></span>
<span><span class="co">## 8               0              55.88580 1</span></span>
<span><span class="co">## 9               0              48.75039 1</span></span>
<span><span class="co">## 10              0              46.05934 1</span></span></code></pre>
<p>And finally, an example of generating a count outcome. Note, the
weight variable here has been grand mean centered in the generation (ie.
mean = 0). This helps to ensure that the counts are not too large.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">321</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">sim_arguments</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">weight</span> <span class="op">+</span> <span class="va">sex</span>,</span>
<span>  fixed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>var_type <span class="op">=</span> <span class="st">'continuous'</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>,</span>
<span>               sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>var_type <span class="op">=</span> <span class="st">'factor'</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'male'</span>, <span class="st">'female'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>variance <span class="op">=</span> <span class="fl">25</span><span class="op">)</span>,</span>
<span>  sample_size <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  reg_weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">0.01</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>  outcome_type <span class="op">=</span> <span class="st">'count'</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/simulate_fixed.html">simulate_fixed</a></span><span class="op">(</span>data <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">sim_arguments</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/simulate_error.html">simulate_error</a></span><span class="op">(</span><span class="va">sim_arguments</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/generate_response.html">generate_response</a></span><span class="op">(</span><span class="va">sim_arguments</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    X.Intercept.     weight sex_1    sex level1_id      error fixed_outcome</span></span>
<span><span class="co">## 1             1  51.147097     0   male         1 -4.0233584      2.511471</span></span>
<span><span class="co">## 2             1 -21.361157     0   male         2  2.2803457      1.786388</span></span>
<span><span class="co">## 3             1  -8.339547     1 female         3  2.1016629      2.416605</span></span>
<span><span class="co">## 4             1  -3.589471     0   male         4  2.8879225      1.964105</span></span>
<span><span class="co">## 5             1  -3.718819     0   male         5  2.2317803      1.962812</span></span>
<span><span class="co">## 6             1   8.045513     1 female         6  4.5862776      2.580455</span></span>
<span><span class="co">## 7             1  21.805245     1 female         7 -0.5353077      2.718052</span></span>
<span><span class="co">## 8             1   6.994062     1 female         8  4.9416770      2.569941</span></span>
<span><span class="co">## 9             1  10.173416     0   male         9 -5.3611940      2.101734</span></span>
<span><span class="co">## 10            1 -16.557440     1 female        10 -3.7900764      2.334426</span></span>
<span><span class="co">##    random_effects untransformed_outcome    y</span></span>
<span><span class="co">## 1               0             -1.511887    0</span></span>
<span><span class="co">## 2               0              4.066734   53</span></span>
<span><span class="co">## 3               0              4.518267   95</span></span>
<span><span class="co">## 4               0              4.852028  115</span></span>
<span><span class="co">## 5               0              4.194592   70</span></span>
<span><span class="co">## 6               0              7.166733 1240</span></span>
<span><span class="co">## 7               0              2.182745   11</span></span>
<span><span class="co">## 8               0              7.511618 1767</span></span>
<span><span class="co">## 9               0             -3.259460    0</span></span>
<span><span class="co">## 10              0             -1.455651    0</span></span></code></pre>
</div>
</div>
</div>
<div class="section level2">
<h2 id="functions-for-power-analysis">Functions for Power Analysis<a class="anchor" aria-label="anchor" href="#functions-for-power-analysis"></a>
</h2>
<p>Now that the basics of tidy simulation have been shown in the context
of a linear regression model, let’s explore an example in which the
power for this model is to be evaluated. In particular, suppose we are
interested in estimating empirical power for the three fixed effects
based on the following formula: <code>y ~ 1 + weight + age + sex</code>.
More specifically, we are interested in estimating power for “weight”,
“age”, and “sex” variables. A few additional functions are needed for
this step including:</p>
<ul>
<li>
<code>model_fit</code>: this function will fit a model to the
data.</li>
<li>
<code>extract_coefficients</code>: this function will extract the
fixed coefficients based on the model fitted.</li>
</ul>
<p>To fit a model and extract coefficients, we could do the following
building off the example from the previous section:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">321</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">sim_arguments</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">weight</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">sex</span>,</span>
<span>  fixed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>var_type <span class="op">=</span> <span class="st">'continuous'</span>, mean <span class="op">=</span> <span class="fl">180</span>, sd <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>,</span>
<span>               age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>var_type <span class="op">=</span> <span class="st">'ordinal'</span>, levels <span class="op">=</span> <span class="fl">30</span><span class="op">:</span><span class="fl">60</span><span class="op">)</span>,</span>
<span>               sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>var_type <span class="op">=</span> <span class="st">'factor'</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'male'</span>, <span class="st">'female'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>variance <span class="op">=</span> <span class="fl">25</span><span class="op">)</span>,</span>
<span>  sample_size <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  reg_weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">0.3</span>, <span class="op">-</span><span class="fl">0.1</span>, <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/simulate_fixed.html">simulate_fixed</a></span><span class="op">(</span>data <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">sim_arguments</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/simulate_error.html">simulate_error</a></span><span class="op">(</span><span class="va">sim_arguments</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/generate_response.html">generate_response</a></span><span class="op">(</span><span class="va">sim_arguments</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/model_fit.html">model_fit</a></span><span class="op">(</span><span class="va">sim_arguments</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/extract_coefficients.html">extract_coefficients</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 4 × 5</span></span></span>
<span><span class="co">##   term        estimate std.error statistic p.value</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> (Intercept)    1.13     20.3      0.055<span style="text-decoration: underline;">3</span>  0.958 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> weight         0.328     0.103    3.19    0.018<span style="text-decoration: underline;">9</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> age           -<span style="color: #BB0000;">0.198</span>     0.271   -<span style="color: #BB0000;">0.733</span>   0.491 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> sexfemale     -<span style="color: #BB0000;">1.87</span>      5.93    -<span style="color: #BB0000;">0.315</span>   0.763</span></span></code></pre>
<p>This output contains the model output for a single data simulation,
more specifically we can see the parameter name, parameter estimate, the
standard error for the parameter estimate, the test statistics, and the
p-value. These were estimated using the <code>lm</code> function based
on the same formula defined in <code>sim_arguments</code>. It is
possible to specify your own formula, model fitting function, and
regression weights to the <code>model_fit</code> function. For example,
suppose we knew that weight was an important predictor, but are unable
to collect it in real life. We could then specify an alternative model
when evaluating power, but include the variable in the data generation
step.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">321</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">sim_arguments</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">weight</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">sex</span>,</span>
<span>  fixed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>var_type <span class="op">=</span> <span class="st">'continuous'</span>, mean <span class="op">=</span> <span class="fl">180</span>, sd <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>,</span>
<span>               age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>var_type <span class="op">=</span> <span class="st">'ordinal'</span>, levels <span class="op">=</span> <span class="fl">30</span><span class="op">:</span><span class="fl">60</span><span class="op">)</span>,</span>
<span>               sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>var_type <span class="op">=</span> <span class="st">'factor'</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'male'</span>, <span class="st">'female'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>variance <span class="op">=</span> <span class="fl">25</span><span class="op">)</span>,</span>
<span>  sample_size <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  reg_weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">0.3</span>, <span class="op">-</span><span class="fl">0.1</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>  model_fit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">sex</span>,</span>
<span>                   model_function <span class="op">=</span> <span class="st">'lm'</span><span class="op">)</span>,</span>
<span>  reg_weights_model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="op">-</span><span class="fl">0.1</span>, <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/simulate_fixed.html">simulate_fixed</a></span><span class="op">(</span>data <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">sim_arguments</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/simulate_error.html">simulate_error</a></span><span class="op">(</span><span class="va">sim_arguments</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/generate_response.html">generate_response</a></span><span class="op">(</span><span class="va">sim_arguments</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/model_fit.html">model_fit</a></span><span class="op">(</span><span class="va">sim_arguments</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/extract_coefficients.html">extract_coefficients</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 5</span></span></span>
<span><span class="co">##   term        estimate std.error statistic p.value</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> (Intercept)  48.0       21.3       2.25   0.059<span style="text-decoration: underline;">4</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> age           0.048<span style="text-decoration: underline;">8</span>     0.394     0.124  0.905 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> sexfemale     2.25       8.79      0.256  0.805</span></span></code></pre>
<p>Notice that we now get very different parameter estimates for this
single data generation process which reflects the contribution of the
variable “weight” that is not taken into account in the model
fitting.</p>
<div class="section level3">
<h3 id="replicate-analysis">Replicate Analysis<a class="anchor" aria-label="anchor" href="#replicate-analysis"></a>
</h3>
<p>When evaluating empirical power, it is essential to replicate the
analysis just like a Monte Carlo study to avoid extreme simulation
conditions. The simglm package offers functions to aid in the
replication given the simulation conditions and the desired simulation
framework. To do this, two additional functions are used:</p>
<ul>
<li>
<code>replicate_simulation</code>: this function replicates the
simulation</li>
<li>
<code>compute_statistics</code>: this function compute desired
statistics across the replications.</li>
</ul>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">321</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">sim_arguments</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">weight</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">sex</span>,</span>
<span>  fixed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>var_type <span class="op">=</span> <span class="st">'continuous'</span>, mean <span class="op">=</span> <span class="fl">180</span>, sd <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>,</span>
<span>               age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>var_type <span class="op">=</span> <span class="st">'ordinal'</span>, levels <span class="op">=</span> <span class="fl">30</span><span class="op">:</span><span class="fl">60</span><span class="op">)</span>,</span>
<span>               sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>var_type <span class="op">=</span> <span class="st">'factor'</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'male'</span>, <span class="st">'female'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>variance <span class="op">=</span> <span class="fl">25</span><span class="op">)</span>,</span>
<span>  sample_size <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  reg_weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">0.3</span>, <span class="op">-</span><span class="fl">0.1</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>  model_fit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">sex</span>,</span>
<span>                   model_function <span class="op">=</span> <span class="st">'lm'</span>,</span>
<span>                   reg_weights_model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="op">-</span><span class="fl">0.1</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  replications <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  extract_coefficients <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/replicate_simulation.html">replicate_simulation</a></span><span class="op">(</span><span class="va">sim_arguments</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/compute_statistics.html">compute_statistics</a></span><span class="op">(</span><span class="va">sim_arguments</span>, alternative_power <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>                     type_1_error <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 7</span></span></span>
<span><span class="co">##   term   avg_estimate power param_estimate_sd avg_standard_error precision_ratio</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> (Inte…      46.1      0.3            26.1               19.2             1.36 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> age          0.085<span style="text-decoration: underline;">2</span>   0.1             0.583              0.396           1.47 </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> sexfe…       1.51     0               6.66               7.50            0.888</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 1 more variable: replications &lt;dbl&gt;</span></span></span></code></pre>
<p>As can be seen from the output, the default behavior is to return
statistics for power, average test statistic, adjusted average test
statistic, standard deviation of parameter estimate, average standard
error, precision ration (standard deviation of parameter estimate
divided by average standard error), and the number of replications for
each term.</p>
<p>To generate this output, only the number of replications is needed.
Here only 10 replications were done, in practice many more replications
would be done to ensure there are accurate results.</p>
<p>The default power parameter values used are: Normal distribution,
two-tailed alternative hypotheses, and alpha of 0.05. Additional power
parameters can be passed directly to override default values by
including a power argument within the simulation arguments. For example,
if a t-distribution with one degree of freedom an alpha of 0.02 is
desired, these can be added as follows:</p>
<p>Note: A user would likely want to change
<code>plan(sequential)</code> to something like
<code>plan(mutisession)</code> or <code>plan(multicore)</code> to run
these in parallel. <code>plan(sequential)</code> is used here for
vignette processing.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">321</span><span class="op">)</span> </span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org" class="external-link">future</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">sequential</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim_arguments</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">weight</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">sex</span>,</span>
<span>  fixed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>var_type <span class="op">=</span> <span class="st">'continuous'</span>, mean <span class="op">=</span> <span class="fl">180</span>, sd <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>,</span>
<span>               age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>var_type <span class="op">=</span> <span class="st">'ordinal'</span>, levels <span class="op">=</span> <span class="fl">30</span><span class="op">:</span><span class="fl">60</span><span class="op">)</span>,</span>
<span>               sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>var_type <span class="op">=</span> <span class="st">'factor'</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'male'</span>, <span class="st">'female'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>variance <span class="op">=</span> <span class="fl">25</span><span class="op">)</span>,</span>
<span>  sample_size <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  reg_weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">0.3</span>, <span class="op">-</span><span class="fl">0.1</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>  model_fit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">sex</span>,</span>
<span>                   model_function <span class="op">=</span> <span class="st">'lm'</span>,</span>
<span>                   reg_weights_model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="op">-</span><span class="fl">0.1</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  replications <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  power <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    dist <span class="op">=</span> <span class="st">'qt'</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">.02</span>,</span>
<span>    opts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>df <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  extract_coefficients <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/replicate_simulation.html">replicate_simulation</a></span><span class="op">(</span><span class="va">sim_arguments</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/compute_statistics.html">compute_statistics</a></span><span class="op">(</span><span class="va">sim_arguments</span>, alternative_power <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>                     type_1_error <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 7</span></span></span>
<span><span class="co">##   term   avg_estimate power param_estimate_sd avg_standard_error precision_ratio</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> (Inte…      56.0    1                 7.83               7.83            1.000</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> age         -<span style="color: #BB0000;">0.099</span><span style="color: #BB0000; text-decoration: underline;">4</span> 0.014             0.166              0.168           0.991</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> sexfe…       0.439  0.01              3.01               2.98            1.01 </span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 1 more variable: replications &lt;dbl&gt;</span></span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="nested-designs">Nested Designs<a class="anchor" aria-label="anchor" href="#nested-designs"></a>
</h2>
<p>Nested designs are ones in which data belong to multiple levels. An
example could be individuals nested within neighborhoods. In this
example, a specific individual is tied directly to one neighborhood.
These types of data often include correlations between individuals
within a neighborhood that need to be taken into account when modeling
the data. These types of data can be generated with simglm.</p>
<p>To do this, the formula syntax introduced above is modified slightly
to include information on the nesting structure. In the example below,
the nesting structure in the formula is specified in the portion within
the parentheses. How the part within parentheses could be read is, add a
random intercept effect for each neighborhood. This random intercept
effect is similar to random error found in regression models, except the
error is associated with neighborhoods and is the same values for all
individuals within that neighborhood. The simulation arguments,
<code>randomeffect</code> provides information about this term. One
element that is often of interest to modify is the variance of the
random effect term(s). For example, if the variance of the random effect
should be 8, then the argument, <code>variance = 8</code>, could be
added to the specific term as shown below.</p>
<p>Finally, the <code>sample_size</code> argument needs to be modified
to include information about the two levels of nested. You could read
the <code>sample_size = list(level1 = 10, level2 = 20)</code> argument
below as: create 20 neighborhoods (ie. <code>level2 = 20</code>) and
within each neighborhood have 10 individuals (ie.
<code>level1 = 10</code>). Therefore the total sample size (ie. rows in
the data) would be 200.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">321</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">sim_arguments</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">weight</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">sex</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">neighborhood</span><span class="op">)</span>,</span>
<span>  reg_weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="op">-</span><span class="fl">0.03</span>, <span class="fl">0.2</span>, <span class="fl">0.33</span><span class="op">)</span>,</span>
<span>  fixed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>var_type <span class="op">=</span> <span class="st">'continuous'</span>, mean <span class="op">=</span> <span class="fl">180</span>, sd <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>,</span>
<span>               age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>var_type <span class="op">=</span> <span class="st">'ordinal'</span>, levels <span class="op">=</span> <span class="fl">30</span><span class="op">:</span><span class="fl">60</span><span class="op">)</span>,</span>
<span>               sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>var_type <span class="op">=</span> <span class="st">'factor'</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'male'</span>, <span class="st">'female'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  randomeffect <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>int_neighborhood <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>variance <span class="op">=</span> <span class="fl">8</span>, var_level <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  sample_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>level1 <span class="op">=</span> <span class="fl">10</span>, level2 <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">nested_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_fixed.html">simulate_fixed</a></span><span class="op">(</span>data <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">sim_arguments</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/simulate_randomeffect.html">simulate_randomeffect</a></span><span class="op">(</span><span class="va">sim_arguments</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/simulate_error.html">simulate_error</a></span><span class="op">(</span><span class="va">sim_arguments</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/generate_response.html">generate_response</a></span><span class="op">(</span><span class="va">sim_arguments</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">nested_data</span>, n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    X.Intercept.   weight age sex_1    sex level1_id neighborhood</span></span>
<span><span class="co">## 1             1 231.1471  39     0   male         1            1</span></span>
<span><span class="co">## 2             1 158.6388  30     0   male         2            1</span></span>
<span><span class="co">## 3             1 171.6605  35     0   male         3            1</span></span>
<span><span class="co">## 4             1 176.4105  42     0   male         4            1</span></span>
<span><span class="co">## 5             1 176.2812  46     0   male         5            1</span></span>
<span><span class="co">## 6             1 188.0455  34     0   male         6            1</span></span>
<span><span class="co">## 7             1 201.8052  43     1 female         7            1</span></span>
<span><span class="co">## 8             1 186.9941  38     1 female         8            1</span></span>
<span><span class="co">## 9             1 190.1734  53     0   male         9            1</span></span>
<span><span class="co">## 10            1 163.4426  41     1 female        10            1</span></span>
<span><span class="co">##    int_neighborhood      error fixed_outcome random_effects         y</span></span>
<span><span class="co">## 1          1.398851 -0.4700086      4.865587       1.398851  5.794429</span></span>
<span><span class="co">## 2          1.398851  1.0499201      5.240835       1.398851  7.689606</span></span>
<span><span class="co">## 3          1.398851  1.3339871      5.850186       1.398851  8.583024</span></span>
<span><span class="co">## 4          1.398851  0.7412679      7.107684       1.398851  9.247803</span></span>
<span><span class="co">## 5          1.398851 -1.0045606      7.911565       1.398851  8.305855</span></span>
<span><span class="co">## 6          1.398851  1.9360082      5.158635       1.398851  8.493493</span></span>
<span><span class="co">## 7          1.398851  0.3692732      6.875843       1.398851  8.643967</span></span>
<span><span class="co">## 8          1.398851  1.3708928      6.320178       1.398851  9.089922</span></span>
<span><span class="co">## 9          1.398851 -0.1077046      8.894798       1.398851 10.185944</span></span>
<span><span class="co">## 10         1.398851  1.1553718      7.626723       1.398851 10.180946</span></span></code></pre>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">nested_data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 200</span></span></code></pre>
<p>The vignette simulation_arguments contains more example of specifying
random effects and additional nesting designs including three levels of
nested and multiple membership models.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://brandonlebeau.org" class="external-link">Brandon LeBeau</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer>
</div>






  </body>
</html>
